# Melos Monorepoç®¡ç†é…ç½®
# æ›´å¤šä¿¡æ¯: https://pub.dev/packages/melos

name: desktop_pet

# åŒ…é…ç½®
packages:
  - .
  - pro_*/**
  - packages/**
  - apps/**
  - tools/**
  - modules/**

# å¿½ç•¥é…ç½®
ignore:
  - "**/.*"
  - "**/build/**"
  - "**/.dart_tool/**"
  - "**/generated/**"
  - "**/*.g.dart"
  - "**/*.freezed.dart"
  - "**/*.mocks.dart"

# IDEé…ç½®
ide:
  intellij:
    enabled: true
    moduleNamePrefix: "desktop_pet_"

# å‘½ä»¤é…ç½®
command:
  version:
    # ç‰ˆæœ¬ç®¡ç†ç­–ç•¥
    strategy: all
    # æ›´æ–°ä¾èµ–
    updateGitTagRefs: true
    # å·¥ä½œåŒºä¾èµ–
    workspaceChangelog: true

# è„šæœ¬é…ç½®
scripts:
  # === å¼€å‘è„šæœ¬ ===

  # ğŸš€ è·å–æ‰€æœ‰ä¾èµ–
  get:
    run: melos exec -- "flutter pub get"
    description: è·å–æ‰€æœ‰åŒ…çš„ä¾èµ–

  # ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶
  clean:
    run: melos exec -- "flutter clean"
    description: æ¸…ç†æ‰€æœ‰åŒ…çš„æ„å»ºæ–‡ä»¶

  # ğŸ”„ é‡ç½®é¡¹ç›®
  reset:
    run: |
      melos clean
      melos get
    description: é‡ç½®æ•´ä¸ªé¡¹ç›®ï¼ˆæ¸…ç†+è·å–ä¾èµ–ï¼‰

  # ğŸ”§ ä»£ç ç”Ÿæˆ
  generate:
    run: melos exec -- "dart run build_runner build --delete-conflicting-outputs"
    description: è¿è¡Œä»£ç ç”Ÿæˆ
    packageFilters:
      dependsOn: "build_runner"

  # ğŸ‘€ ç›‘å¬ä»£ç ç”Ÿæˆ
  watch:
    run: melos exec -- "dart run build_runner watch --delete-conflicting-outputs"
    description: ç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨ç”Ÿæˆä»£ç 
    packageFilters:
      dependsOn: "build_runner"

  # === è´¨é‡ä¿è¯è„šæœ¬ ===

  # ğŸ“Š ä»£ç åˆ†æ
  analyze:
    run: melos exec -- "dart analyze ."
    description: åˆ†ææ‰€æœ‰åŒ…çš„ä»£ç è´¨é‡

  # ğŸ¨ ä»£ç æ ¼å¼åŒ–
  format:
    run: melos exec -- "dart format . --set-exit-if-changed"
    description: æ ¼å¼åŒ–æ‰€æœ‰åŒ…çš„ä»£ç 

  # ğŸ” æ ¼å¼æ£€æŸ¥
  format-check:
    run: melos exec -- "dart format . --output=none --set-exit-if-changed"
    description: æ£€æŸ¥ä»£ç æ ¼å¼æ˜¯å¦æ­£ç¡®

  # âœ… è´¨é‡æ£€æŸ¥
  quality:
    run: |
      melos format-check
      melos analyze
    description: è¿è¡Œæ‰€æœ‰è´¨é‡æ£€æŸ¥

  # ğŸ”§ ä¿®å¤ä»£ç 
  fix:
    run: melos exec -- "dart fix --apply"
    description: è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜

  # === æµ‹è¯•è„šæœ¬ ===

  # ğŸ§ª å•å…ƒæµ‹è¯•
  test:
    run: melos exec -- "flutter test"
    description: è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
    packageFilters:
      dirExists: test

  # ğŸ“± Widgetæµ‹è¯•
  test-widget:
    run: melos exec -- "flutter test test/widget"
    description: è¿è¡ŒWidgetæµ‹è¯•
    packageFilters:
      dirExists: test/widget

  # ğŸ”— é›†æˆæµ‹è¯•
  test-integration:
    run: melos exec -- "flutter test integration_test"
    description: è¿è¡Œé›†æˆæµ‹è¯•
    packageFilters:
      dirExists: integration_test

  # ğŸ“Š æµ‹è¯•è¦†ç›–ç‡
  coverage:
    run: melos exec -- "flutter test --coverage"
    description: ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
    packageFilters:
      dirExists: test

  # ğŸ¯ å®Œæ•´æµ‹è¯•
  test-all:
    run: |
      melos test
      melos test-widget
      melos test-integration
    description: è¿è¡Œæ‰€æœ‰ç±»å‹çš„æµ‹è¯•

  # === æ„å»ºè„šæœ¬ ===

  # ğŸ—ï¸ æ„å»ºæ‰€æœ‰
  build:
    run: melos exec -- "flutter build"
    description: æ„å»ºæ‰€æœ‰åº”ç”¨
    packageFilters:
      scope: "apps/*"

  # ğŸ“¦ æ„å»ºAPK
  build-apk:
    run: melos exec -- "flutter build apk"
    description: æ„å»ºAndroid APK
    packageFilters:
      scope: "apps/*"

  # ğŸ æ„å»ºiOS
  build-ios:
    run: melos exec -- "flutter build ios"
    description: æ„å»ºiOSåº”ç”¨
    packageFilters:
      scope: "apps/*"

  # ğŸŒ æ„å»ºWeb
  build-web:
    run: melos exec -- "flutter build web"
    description: æ„å»ºWebåº”ç”¨
    packageFilters:
      scope: "apps/*"

  # === ä¾èµ–ç®¡ç†è„šæœ¬ ===

  # ğŸ“‹ ä¾èµ–åˆ—è¡¨
  deps:
    run: melos list --long
    description: æ˜¾ç¤ºæ‰€æœ‰åŒ…åŠå…¶ä¾èµ–

  # ğŸ”„ æ›´æ–°ä¾èµ–
  upgrade:
    run: melos exec -- "flutter pub upgrade"
    description: æ›´æ–°æ‰€æœ‰åŒ…çš„ä¾èµ–

  # ğŸ” ä¾èµ–æ£€æŸ¥
  deps-check:
    run: melos exec -- "flutter pub deps"
    description: æ£€æŸ¥ä¾èµ–å…³ç³»

  # ğŸ§¹ ä¾èµ–æ¸…ç†
  deps-clean:
    run: |
      melos exec -- "flutter pub deps --style=compact"
      melos exec -- "flutter pub get --offline"
    description: æ¸…ç†å¹¶é‡æ–°è·å–ä¾èµ–

  # ğŸ“Š ä¾èµ–å›¾
  deps-graph:
    run: melos graph
    description: ç”Ÿæˆä¾èµ–å…³ç³»å›¾

  # ğŸš€ å®Œæ•´å·¥ä½œæµ
  workflow:
    run: |
      echo "ğŸ§¹ æ¸…ç†é¡¹ç›®..."
      melos clean
      echo "ğŸ“¦ è·å–ä¾èµ–..."
      melos get
      echo "ğŸ”§ ç”Ÿæˆä»£ç ..."
      melos generate
      echo "ğŸ“Š è´¨é‡æ£€æŸ¥..."
      melos quality
      echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
      melos test
      echo "âœ… å·¥ä½œæµå®Œæˆï¼"
    description: è¿è¡Œå®Œæ•´çš„å¼€å‘å·¥ä½œæµ
