# Creative Workshop æ’ä»¶å¼€å‘æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»å¦‚ä½•ä¸º Creative Workshop å¼€å‘è‡ªå®šä¹‰æ’ä»¶ï¼ŒåŒ…æ‹¬æ’ä»¶æ¶æ„ã€å¼€å‘æµç¨‹ã€æœ€ä½³å®è·µç­‰å†…å®¹ã€‚

**ğŸ”„ Phase 5.0.6**: ä¼ä¸šçº§æ’ä»¶ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå®Œæ•´çš„æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†

## æ’ä»¶æ¶æ„

### 1. æ’ä»¶åŸºç¡€æ¶æ„

Creative Workshop é‡‡ç”¨åŒæ ¸å¿ƒæ’ä»¶æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Plugin Architecture                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Plugin      â”‚ â”‚ Plugin      â”‚ â”‚ Permission  â”‚ â”‚ Event   â”‚ â”‚
â”‚  â”‚ Manager     â”‚ â”‚ Registry    â”‚ â”‚ System      â”‚ â”‚ System  â”‚ â”‚
â”‚  â”‚ ç”Ÿå‘½å‘¨æœŸç®¡ç† â”‚ â”‚ æ³¨å†Œè¡¨ç®¡ç†   â”‚ â”‚ æƒé™æ§åˆ¶     â”‚ â”‚ äº‹ä»¶é©±åŠ¨ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Tool        â”‚ â”‚ Game        â”‚ â”‚ Utility     â”‚ â”‚ Theme   â”‚ â”‚
â”‚  â”‚ Plugins     â”‚ â”‚ Plugins     â”‚ â”‚ Plugins     â”‚ â”‚ Plugins â”‚ â”‚
â”‚  â”‚ å·¥å…·æ’ä»¶     â”‚ â”‚ æ¸¸æˆæ’ä»¶     â”‚ â”‚ å®ç”¨æ’ä»¶     â”‚ â”‚ ä¸»é¢˜æ’ä»¶ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ’ä»¶ç±»å‹

Creative Workshop æ”¯æŒ5ç§æ’ä»¶ç±»å‹ï¼š

- **å·¥å…·æ’ä»¶ (Tool)**: æä¾›ç‰¹å®šåŠŸèƒ½çš„å·¥å…·
- **æ¸¸æˆæ’ä»¶ (Game)**: å¨±ä¹å’Œæ¸¸æˆåŠŸèƒ½
- **å®ç”¨æ’ä»¶ (Utility)**: ç³»ç»Ÿå®ç”¨ç¨‹åº
- **ä¸»é¢˜æ’ä»¶ (Theme)**: ç•Œé¢ä¸»é¢˜å’Œæ ·å¼
- **å…¶ä»–æ’ä»¶ (Other)**: è‡ªå®šä¹‰åŠŸèƒ½æ’ä»¶

## å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºæ’ä»¶é¡¹ç›®

```bash
# ä½¿ç”¨ Ming CLI åˆ›å»ºæ’ä»¶é¡¹ç›®
ming create plugin my_awesome_plugin

# æˆ–æ‰‹åŠ¨åˆ›å»ºç›®å½•ç»“æ„
mkdir my_awesome_plugin
cd my_awesome_plugin
```

### 2. åŸºç¡€æ’ä»¶ç»“æ„

```dart
// lib/my_awesome_plugin.dart
import 'package:creative_workshop/creative_workshop.dart';

class MyAwesomePlugin extends Plugin {
  @override
  String get id => 'my_awesome_plugin';
  
  @override
  String get name => 'æˆ‘çš„è¶…æ£’æ’ä»¶';
  
  @override
  String get version => '1.0.0';
  
  @override
  String get description => 'è¿™æ˜¯ä¸€ä¸ªè¶…æ£’çš„ç¤ºä¾‹æ’ä»¶';
  
  @override
  PluginMetadata get metadata => const PluginMetadata(
    id: 'my_awesome_plugin',
    name: 'æˆ‘çš„è¶…æ£’æ’ä»¶',
    version: '1.0.0',
    description: 'è¿™æ˜¯ä¸€ä¸ªè¶…æ£’çš„ç¤ºä¾‹æ’ä»¶',
    author: 'ä½ çš„åå­—',
    category: 'tool',
    keywords: ['å·¥å…·', 'ç¤ºä¾‹', 'è¶…æ£’'],
    permissions: [
      PluginPermission.fileSystem,
    ],
  );
  
  bool _isInitialized = false;
  bool _isRunning = false;
  
  @override
  bool get isInitialized => _isInitialized;
  
  @override
  bool get isRunning => _isRunning;
  
  @override
  Future<void> initialize() async {
    print('åˆå§‹åŒ–æ’ä»¶: $name');
    // åœ¨è¿™é‡Œæ·»åŠ åˆå§‹åŒ–é€»è¾‘
    _isInitialized = true;
  }
  
  @override
  Future<void> start() async {
    if (!_isInitialized) {
      throw StateError('Plugin not initialized');
    }
    
    print('å¯åŠ¨æ’ä»¶: $name');
    // åœ¨è¿™é‡Œæ·»åŠ å¯åŠ¨é€»è¾‘
    _isRunning = true;
  }
  
  @override
  Future<void> stop() async {
    print('åœæ­¢æ’ä»¶: $name');
    // åœ¨è¿™é‡Œæ·»åŠ åœæ­¢é€»è¾‘
    _isRunning = false;
  }
  
  @override
  Future<void> dispose() async {
    print('é‡Šæ”¾æ’ä»¶: $name');
    // åœ¨è¿™é‡Œæ·»åŠ æ¸…ç†é€»è¾‘
    _isRunning = false;
    _isInitialized = false;
  }
}
```

### 3. æ³¨å†Œæ’ä»¶

```dart
// lib/plugin_registration.dart
import 'package:creative_workshop/creative_workshop.dart';
import 'my_awesome_plugin.dart';

void registerMyAwesomePlugin() {
  final metadata = PluginMetadata(
    id: 'my_awesome_plugin',
    name: 'æˆ‘çš„è¶…æ£’æ’ä»¶',
    version: '1.0.0',
    description: 'è¿™æ˜¯ä¸€ä¸ªè¶…æ£’çš„ç¤ºä¾‹æ’ä»¶',
    author: 'ä½ çš„åå­—',
    category: 'tool',
    keywords: ['å·¥å…·', 'ç¤ºä¾‹', 'è¶…æ£’'],
    permissions: [
      PluginPermission.fileSystem,
    ],
  );

  PluginRegistry.instance.registerPlugin(
    metadata,
    () => MyAwesomePlugin(),
  );
}

// åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨
void initializePlugins() {
  registerMyAwesomePlugin();
  // æ³¨å†Œå…¶ä»–æ’ä»¶...
}
```

## æ’ä»¶å…ƒæ•°æ®

### 1. åŸºç¡€å…ƒæ•°æ®

```dart
const PluginMetadata(
  id: 'unique_plugin_id',           // å”¯ä¸€æ ‡è¯†ç¬¦
  name: 'æ’ä»¶æ˜¾ç¤ºåç§°',               // ç”¨æˆ·çœ‹åˆ°çš„åç§°
  version: '1.0.0',                // è¯­ä¹‰åŒ–ç‰ˆæœ¬å·
  description: 'æ’ä»¶åŠŸèƒ½æè¿°',        // è¯¦ç»†æè¿°
  author: 'å¼€å‘è€…åç§°',              // ä½œè€…ä¿¡æ¯
  category: 'tool',                // æ’ä»¶ç±»åˆ«
  keywords: ['å…³é”®è¯1', 'å…³é”®è¯2'],   // æœç´¢å…³é”®è¯
  permissions: [                   // æ‰€éœ€æƒé™
    PluginPermission.fileSystem,
    PluginPermission.network,
  ],
);
```

### 2. é«˜çº§å…ƒæ•°æ®

```dart
const PluginMetadata(
  id: 'advanced_plugin',
  name: 'é«˜çº§æ’ä»¶',
  version: '2.1.0',
  description: 'å…·æœ‰é«˜çº§åŠŸèƒ½çš„æ’ä»¶',
  author: 'é«˜çº§å¼€å‘è€…',
  category: 'utility',
  homepage: 'https://example.com/plugin',
  repository: 'https://github.com/user/plugin',
  license: 'MIT',
  keywords: ['é«˜çº§', 'åŠŸèƒ½', 'å®ç”¨'],
  screenshots: [
    'https://example.com/screenshot1.png',
    'https://example.com/screenshot2.png',
  ],
  minAppVersion: '5.0.0',
  maxAppVersion: '6.0.0',
  permissions: [
    PluginPermission.fileSystem,
    PluginPermission.network,
    PluginPermission.notifications,
  ],
  dependencies: [
    PluginDependency(
      pluginId: 'base_plugin',
      version: '1.0.0',
      isRequired: true,
    ),
    PluginDependency(
      pluginId: 'optional_plugin',
      version: '1.5.0',
      isRequired: false,
    ),
  ],
);
```

## æƒé™ç³»ç»Ÿ

### 1. æƒé™ç±»å‹

Creative Workshop æ”¯æŒ8ç§æƒé™ç±»å‹ï¼š

```dart
enum PluginPermission {
  fileSystem('æ–‡ä»¶ç³»ç»Ÿè®¿é—®'),      // è¯»å†™æ–‡ä»¶
  network('ç½‘ç»œè®¿é—®'),           // ç½‘ç»œè¯·æ±‚
  notifications('ç³»ç»Ÿé€šçŸ¥'),     // å‘é€é€šçŸ¥
  clipboard('å‰ªè´´æ¿è®¿é—®'),       // å‰ªè´´æ¿æ“ä½œ
  camera('ç›¸æœºè®¿é—®'),           // ç›¸æœºåŠŸèƒ½
  microphone('éº¦å…‹é£è®¿é—®'),     // éº¦å…‹é£åŠŸèƒ½
  location('ä½ç½®ä¿¡æ¯'),         // åœ°ç†ä½ç½®
  deviceInfo('è®¾å¤‡ä¿¡æ¯');       // è®¾å¤‡ä¿¡æ¯
}
```

### 2. æƒé™ä½¿ç”¨ç¤ºä¾‹

```dart
class FileAccessPlugin extends Plugin {
  @override
  PluginMetadata get metadata => const PluginMetadata(
    id: 'file_access_plugin',
    name: 'æ–‡ä»¶è®¿é—®æ’ä»¶',
    version: '1.0.0',
    description: 'æ¼”ç¤ºæ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™çš„æ’ä»¶',
    author: 'å¼€å‘è€…',
    category: 'utility',
    permissions: [
      PluginPermission.fileSystem,  // å£°æ˜æ–‡ä»¶ç³»ç»Ÿæƒé™
    ],
  );
  
  Future<void> readFile(String path) async {
    // æ£€æŸ¥æƒé™
    if (!await _hasPermission(PluginPermission.fileSystem)) {
      throw PermissionDeniedException('æ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™è¢«æ‹’ç»');
    }
    
    // æ‰§è¡Œæ–‡ä»¶æ“ä½œ
    // ...
  }
  
  Future<bool> _hasPermission(PluginPermission permission) async {
    // æƒé™æ£€æŸ¥é€»è¾‘
    return true; // ç®€åŒ–ç¤ºä¾‹
  }
}
```

## ä¾èµ–ç®¡ç†

### 1. å®šä¹‰ä¾èµ–

```dart
const PluginMetadata(
  id: 'dependent_plugin',
  name: 'ä¾èµ–æ’ä»¶',
  version: '1.0.0',
  description: 'ä¾èµ–å…¶ä»–æ’ä»¶çš„ç¤ºä¾‹',
  author: 'å¼€å‘è€…',
  category: 'tool',
  dependencies: [
    // å¿…éœ€ä¾èµ–
    PluginDependency(
      pluginId: 'base_plugin',
      version: '1.0.0',
      isRequired: true,
    ),
    // å¯é€‰ä¾èµ–
    PluginDependency(
      pluginId: 'enhancement_plugin',
      version: '2.0.0',
      isRequired: false,
    ),
  ],
);
```

### 2. ä¾èµ–æ£€æŸ¥

```dart
class DependentPlugin extends Plugin {
  @override
  Future<void> initialize() async {
    // æ£€æŸ¥å¿…éœ€ä¾èµ–
    if (!await _checkDependencies()) {
      throw DependencyException('ç¼ºå°‘å¿…éœ€çš„ä¾èµ–æ’ä»¶');
    }
    
    await super.initialize();
  }
  
  Future<bool> _checkDependencies() async {
    final dependencies = metadata.dependencies;

    for (final dep in dependencies) {
      if (dep.isRequired) {
        final isInstalled = PluginManager.instance.isPluginInstalled(dep.pluginId);
        if (!isInstalled) {
          return false;
        }
      }
    }

    return true;
  }
}
```

## æ’ä»¶ç”Ÿå‘½å‘¨æœŸ

### 1. ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ

æ’ä»¶åœ¨ Creative Workshop ä¸­ç»å†ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š

```
æ³¨å†Œ â†’ å®‰è£… â†’ åˆå§‹åŒ– â†’ å¯åŠ¨ â†’ è¿è¡Œ â†’ åœæ­¢ â†’ é‡Šæ”¾ â†’ å¸è½½
```

### 2. ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

```dart
class LifecycleAwarePlugin extends Plugin {
  @override
  Future<void> initialize() async {
    print('æ’ä»¶åˆå§‹åŒ–é˜¶æ®µ');
    // åˆå§‹åŒ–èµ„æºã€é…ç½®ã€æ•°æ®åº“è¿æ¥ç­‰
    await _initializeResources();
    await super.initialize();
  }

  @override
  Future<void> start() async {
    print('æ’ä»¶å¯åŠ¨é˜¶æ®µ');
    // å¯åŠ¨æœåŠ¡ã€æ³¨å†Œç›‘å¬å™¨ã€å¼€å§‹å·¥ä½œç­‰
    await _startServices();
    await super.start();
  }

  @override
  Future<void> stop() async {
    print('æ’ä»¶åœæ­¢é˜¶æ®µ');
    // åœæ­¢æœåŠ¡ã€ä¿å­˜çŠ¶æ€ã€æ¸…ç†ä¸´æ—¶èµ„æºç­‰
    await _stopServices();
    await super.stop();
  }

  @override
  Future<void> dispose() async {
    print('æ’ä»¶é‡Šæ”¾é˜¶æ®µ');
    // é‡Šæ”¾æ‰€æœ‰èµ„æºã€å…³é—­è¿æ¥ã€æ¸…ç†å†…å­˜ç­‰
    await _disposeResources();
    await super.dispose();
  }

  Future<void> _initializeResources() async {
    // åˆå§‹åŒ–é€»è¾‘
  }

  Future<void> _startServices() async {
    // å¯åŠ¨é€»è¾‘
  }

  Future<void> _stopServices() async {
    // åœæ­¢é€»è¾‘
  }

  Future<void> _disposeResources() async {
    // æ¸…ç†é€»è¾‘
  }
}
```

## äº‹ä»¶ç³»ç»Ÿ

### 1. ç›‘å¬æ’ä»¶äº‹ä»¶

```dart
class EventAwarePlugin extends Plugin {
  StreamSubscription<PluginRegistryEvent>? _eventSubscription;

  @override
  Future<void> initialize() async {
    // ç›‘å¬æ’ä»¶æ³¨å†Œè¡¨äº‹ä»¶
    _eventSubscription = PluginRegistry.instance.events.listen(_handleEvent);
    await super.initialize();
  }

  @override
  Future<void> dispose() async {
    // å–æ¶ˆäº‹ä»¶ç›‘å¬
    await _eventSubscription?.cancel();
    await super.dispose();
  }

  void _handleEvent(PluginRegistryEvent event) {
    switch (event.runtimeType) {
      case PluginRegisteredEvent:
        print('æ’ä»¶å·²æ³¨å†Œ: ${event.pluginId}');
        break;
      case PluginStartedEvent:
        print('æ’ä»¶å·²å¯åŠ¨: ${event.pluginId}');
        break;
      case PluginStoppedEvent:
        print('æ’ä»¶å·²åœæ­¢: ${event.pluginId}');
        break;
      case PluginErrorEvent:
        print('æ’ä»¶é”™è¯¯: ${event.pluginId}');
        break;
    }
  }
}
```

### 2. å‘é€è‡ªå®šä¹‰äº‹ä»¶

```dart
class CustomEventPlugin extends Plugin {
  final StreamController<CustomEvent> _eventController = StreamController.broadcast();

  Stream<CustomEvent> get events => _eventController.stream;

  void sendCustomEvent(String message) {
    final event = CustomEvent(
      pluginId: id,
      message: message,
      timestamp: DateTime.now(),
    );
    _eventController.add(event);
  }

  @override
  Future<void> dispose() async {
    await _eventController.close();
    await super.dispose();
  }
}

class CustomEvent {
  final String pluginId;
  final String message;
  final DateTime timestamp;

  const CustomEvent({
    required this.pluginId,
    required this.message,
    required this.timestamp,
  });
}
```

## UI é›†æˆ

### 1. åˆ›å»ºæ’ä»¶ç•Œé¢

```dart
class UIPlugin extends Plugin {
  @override
  PluginMetadata get metadata => const PluginMetadata(
    id: 'ui_plugin',
    name: 'UI æ’ä»¶',
    version: '1.0.0',
    description: 'æ¼”ç¤º UI é›†æˆçš„æ’ä»¶',
    author: 'å¼€å‘è€…',
    category: 'tool',
  );

  Widget buildUI(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(name),
      ),
      body: Column(
        children: [
          Text('è¿™æ˜¯ $name çš„ç•Œé¢'),
          ElevatedButton(
            onPressed: _handleButtonPress,
            child: const Text('æ‰§è¡Œæ“ä½œ'),
          ),
        ],
      ),
    );
  }

  void _handleButtonPress() {
    print('æ’ä»¶æŒ‰é’®è¢«ç‚¹å‡»');
  }
}
```

### 2. é›†æˆåˆ°åº”ç”¨å•†åº—

```dart
class StoreIntegratedPlugin extends Plugin {
  @override
  PluginMetadata get metadata => const PluginMetadata(
    id: 'store_plugin',
    name: 'å•†åº—æ’ä»¶',
    version: '1.0.0',
    description: 'é›†æˆåˆ°åº”ç”¨å•†åº—çš„æ’ä»¶',
    author: 'å¼€å‘è€…',
    category: 'utility',
    screenshots: [
      'assets/screenshot1.png',
      'assets/screenshot2.png',
    ],
  );

  Widget buildStoreCard(BuildContext context) {
    return Card(
      child: ListTile(
        leading: Icon(Icons.extension),
        title: Text(name),
        subtitle: Text(description),
        trailing: ElevatedButton(
          onPressed: () => _installPlugin(context),
          child: const Text('å®‰è£…'),
        ),
      ),
    );
  }

  void _installPlugin(BuildContext context) {
    PluginManager.instance.installPlugin(id).then((result) {
      if (result.success) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('æ’ä»¶å®‰è£…æˆåŠŸ')),
        );
      }
    });
  }
}
```

## æ•°æ®å­˜å‚¨

### 1. æ’ä»¶é…ç½®å­˜å‚¨

```dart
class ConfigurablePlugin extends Plugin {
  static const String _configKey = 'plugin_config';
  Map<String, dynamic> _config = {};

  @override
  Future<void> initialize() async {
    await _loadConfig();
    await super.initialize();
  }

  @override
  Future<void> dispose() async {
    await _saveConfig();
    await super.dispose();
  }

  Future<void> _loadConfig() async {
    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½é…ç½®
    final prefs = await SharedPreferences.getInstance();
    final configJson = prefs.getString('${id}_$_configKey');

    if (configJson != null) {
      _config = json.decode(configJson);
    } else {
      _config = _getDefaultConfig();
    }
  }

  Future<void> _saveConfig() async {
    // ä¿å­˜é…ç½®åˆ°æœ¬åœ°å­˜å‚¨
    final prefs = await SharedPreferences.getInstance();
    final configJson = json.encode(_config);
    await prefs.setString('${id}_$_configKey', configJson);
  }

  Map<String, dynamic> _getDefaultConfig() {
    return {
      'enabled': true,
      'theme': 'light',
      'autoUpdate': true,
    };
  }

  T getConfig<T>(String key, T defaultValue) {
    return _config[key] as T? ?? defaultValue;
  }

  void setConfig<T>(String key, T value) {
    _config[key] = value;
  }
}
```

### 2. æ’ä»¶æ•°æ®ç®¡ç†

```dart
class DataManagedPlugin extends Plugin {
  late Database _database;

  @override
  Future<void> initialize() async {
    await _initializeDatabase();
    await super.initialize();
  }

  @override
  Future<void> dispose() async {
    await _database.close();
    await super.dispose();
  }

  Future<void> _initializeDatabase() async {
    final databasesPath = await getDatabasesPath();
    final path = join(databasesPath, '${id}_data.db');

    _database = await openDatabase(
      path,
      version: 1,
      onCreate: (db, version) async {
        await db.execute('''
          CREATE TABLE plugin_data (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            key TEXT NOT NULL,
            value TEXT NOT NULL,
            created_at INTEGER NOT NULL
          )
        ''');
      },
    );
  }

  Future<void> saveData(String key, String value) async {
    await _database.insert(
      'plugin_data',
      {
        'key': key,
        'value': value,
        'created_at': DateTime.now().millisecondsSinceEpoch,
      },
      conflictAlgorithm: ConflictAlgorithm.replace,
    );
  }

  Future<String?> loadData(String key) async {
    final result = await _database.query(
      'plugin_data',
      where: 'key = ?',
      whereArgs: [key],
      limit: 1,
    );

    if (result.isNotEmpty) {
      return result.first['value'] as String;
    }

    return null;
  }
}

## ç½‘ç»œé€šä¿¡

### 1. HTTP è¯·æ±‚

```dart
class NetworkPlugin extends Plugin {
  final http.Client _httpClient = http.Client();

  @override
  PluginMetadata get metadata => const PluginMetadata(
    id: 'network_plugin',
    name: 'ç½‘ç»œæ’ä»¶',
    version: '1.0.0',
    description: 'æ¼”ç¤ºç½‘ç»œé€šä¿¡çš„æ’ä»¶',
    author: 'å¼€å‘è€…',
    category: 'utility',
    permissions: [
      PluginPermission.network,  // å£°æ˜ç½‘ç»œæƒé™
    ],
  );

  @override
  Future<void> dispose() async {
    _httpClient.close();
    await super.dispose();
  }

  Future<Map<String, dynamic>> fetchData(String url) async {
    try {
      final response = await _httpClient.get(Uri.parse(url));

      if (response.statusCode == 200) {
        return json.decode(response.body);
      } else {
        throw HttpException('HTTP ${response.statusCode}: ${response.reasonPhrase}');
      }
    } catch (e) {
      throw NetworkException('ç½‘ç»œè¯·æ±‚å¤±è´¥: $e');
    }
  }

  Future<void> postData(String url, Map<String, dynamic> data) async {
    try {
      final response = await _httpClient.post(
        Uri.parse(url),
        headers: {'Content-Type': 'application/json'},
        body: json.encode(data),
      );

      if (response.statusCode != 200) {
        throw HttpException('HTTP ${response.statusCode}: ${response.reasonPhrase}');
      }
    } catch (e) {
      throw NetworkException('ç½‘ç»œè¯·æ±‚å¤±è´¥: $e');
    }
  }
}

class NetworkException implements Exception {
  final String message;
  const NetworkException(this.message);

  @override
  String toString() => 'NetworkException: $message';
}
```

### 2. WebSocket é€šä¿¡

```dart
class WebSocketPlugin extends Plugin {
  WebSocketChannel? _channel;
  StreamSubscription? _subscription;

  @override
  PluginMetadata get metadata => const PluginMetadata(
    id: 'websocket_plugin',
    name: 'WebSocket æ’ä»¶',
    version: '1.0.0',
    description: 'æ¼”ç¤º WebSocket é€šä¿¡çš„æ’ä»¶',
    author: 'å¼€å‘è€…',
    category: 'utility',
    permissions: [
      PluginPermission.network,
    ],
  );

  Future<void> connect(String url) async {
    try {
      _channel = WebSocketChannel.connect(Uri.parse(url));
      _subscription = _channel!.stream.listen(
        _handleMessage,
        onError: _handleError,
        onDone: _handleDisconnect,
      );
    } catch (e) {
      throw WebSocketException('WebSocket è¿æ¥å¤±è´¥: $e');
    }
  }

  void sendMessage(String message) {
    if (_channel != null) {
      _channel!.sink.add(message);
    } else {
      throw StateError('WebSocket æœªè¿æ¥');
    }
  }

  void _handleMessage(dynamic message) {
    print('æ”¶åˆ°æ¶ˆæ¯: $message');
    // å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯
  }

  void _handleError(error) {
    print('WebSocket é”™è¯¯: $error');
  }

  void _handleDisconnect() {
    print('WebSocket è¿æ¥æ–­å¼€');
  }

  @override
  Future<void> dispose() async {
    await _subscription?.cancel();
    await _channel?.sink.close();
    await super.dispose();
  }
}

class WebSocketException implements Exception {
  final String message;
  const WebSocketException(this.message);

  @override
  String toString() => 'WebSocketException: $message';
}
```

## æµ‹è¯•å¼€å‘

### 1. å•å…ƒæµ‹è¯•

```dart
// test/my_awesome_plugin_test.dart
import 'package:flutter_test/flutter_test.dart';
import 'package:my_awesome_plugin/my_awesome_plugin.dart';

void main() {
  group('MyAwesomePlugin Tests', () {
    late MyAwesomePlugin plugin;

    setUp(() {
      plugin = MyAwesomePlugin();
    });

    test('should have correct metadata', () {
      expect(plugin.id, 'my_awesome_plugin');
      expect(plugin.name, 'æˆ‘çš„è¶…æ£’æ’ä»¶');
      expect(plugin.version, '1.0.0');
    });

    test('should initialize successfully', () async {
      expect(plugin.isInitialized, isFalse);
      await plugin.initialize();
      expect(plugin.isInitialized, isTrue);
    });

    test('should start and stop correctly', () async {
      await plugin.initialize();

      expect(plugin.isRunning, isFalse);
      await plugin.start();
      expect(plugin.isRunning, isTrue);

      await plugin.stop();
      expect(plugin.isRunning, isFalse);
    });

    test('should dispose correctly', () async {
      await plugin.initialize();
      await plugin.start();
      await plugin.dispose();

      expect(plugin.isInitialized, isFalse);
      expect(plugin.isRunning, isFalse);
    });

    test('should throw error when starting uninitialized plugin', () async {
      expect(() => plugin.start(), throwsStateError);
    });
  });
}
```

### 2. é›†æˆæµ‹è¯•

```dart
// integration_test/plugin_integration_test.dart
import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:integration_test/integration_test.dart';
import 'package:creative_workshop/creative_workshop.dart';
import 'package:my_awesome_plugin/my_awesome_plugin.dart';

void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();

  group('Plugin Integration Tests', () {
    testWidgets('should register and install plugin', (tester) async {
      // æ³¨å†Œæ’ä»¶
      final metadata = PluginMetadata(
        id: 'my_awesome_plugin',
        name: 'æˆ‘çš„è¶…æ£’æ’ä»¶',
        version: '1.0.0',
        description: 'è¿™æ˜¯ä¸€ä¸ªè¶…æ£’çš„ç¤ºä¾‹æ’ä»¶',
        author: 'ä½ çš„åå­—',
        category: 'tool',
      );

      PluginRegistry.instance.registerPlugin(
        metadata,
        () => MyAwesomePlugin(),
      );

      // éªŒè¯æ’ä»¶å·²æ³¨å†Œ
      expect(PluginRegistry.instance.isPluginRegistered('my_awesome_plugin'), isTrue);

      // å®‰è£…æ’ä»¶
      final result = await PluginManager.instance.installPlugin('my_awesome_plugin');
      expect(result.success, isTrue);

      // éªŒè¯æ’ä»¶å·²å®‰è£…
      expect(PluginManager.instance.isPluginInstalled('my_awesome_plugin'), isTrue);
    });

    testWidgets('should display plugin in store', (tester) async {
      await tester.pumpWidget(
        MaterialApp(
          home: CreativeWorkspace(
            initialLayout: WorkspaceLayout.store,
          ),
        ),
      );

      // æŸ¥æ‰¾æ’ä»¶å¡ç‰‡
      expect(find.text('æˆ‘çš„è¶…æ£’æ’ä»¶'), findsOneWidget);
      expect(find.text('è¿™æ˜¯ä¸€ä¸ªè¶…æ£’çš„ç¤ºä¾‹æ’ä»¶'), findsOneWidget);
    });
  });
}
```

## æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–

```dart
class OptimizedPlugin extends Plugin {
  // ä½¿ç”¨æ‡’åŠ è½½
  late final Map<String, dynamic> _cache = {};

  // ä½¿ç”¨å¯¹è±¡æ± 
  final List<ExpensiveObject> _objectPool = [];

  @override
  Future<void> initialize() async {
    // å¼‚æ­¥åˆå§‹åŒ–ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹
    await Future.microtask(() async {
      await _initializeAsync();
    });

    await super.initialize();
  }

  Future<void> _initializeAsync() async {
    // é¢„åŠ è½½å…³é”®èµ„æº
    await _preloadCriticalResources();

    // åˆå§‹åŒ–å¯¹è±¡æ± 
    _initializeObjectPool();
  }

  Future<void> _preloadCriticalResources() async {
    // é¢„åŠ è½½é€»è¾‘
  }

  void _initializeObjectPool() {
    // å¯¹è±¡æ± åˆå§‹åŒ–
    for (int i = 0; i < 10; i++) {
      _objectPool.add(ExpensiveObject());
    }
  }

  ExpensiveObject borrowObject() {
    if (_objectPool.isNotEmpty) {
      return _objectPool.removeLast();
    }
    return ExpensiveObject();
  }

  void returnObject(ExpensiveObject obj) {
    obj.reset();
    _objectPool.add(obj);
  }

  // ä½¿ç”¨ç¼“å­˜
  Future<T> getCachedData<T>(String key, Future<T> Function() loader) async {
    if (_cache.containsKey(key)) {
      return _cache[key] as T;
    }

    final data = await loader();
    _cache[key] = data;
    return data;
  }
}

class ExpensiveObject {
  void reset() {
    // é‡ç½®å¯¹è±¡çŠ¶æ€
  }
}
```

### 2. é”™è¯¯å¤„ç†

```dart
class RobustPlugin extends Plugin {
  @override
  Future<void> initialize() async {
    try {
      await _safeInitialize();
    } catch (e, stackTrace) {
      _handleError('åˆå§‹åŒ–å¤±è´¥', e, stackTrace);
      rethrow;
    }
  }

  Future<void> _safeInitialize() async {
    // å¸¦è¶…æ—¶çš„åˆå§‹åŒ–
    await Future.timeout(
      _doInitialize(),
      const Duration(seconds: 30),
      onTimeout: () {
        throw TimeoutException('æ’ä»¶åˆå§‹åŒ–è¶…æ—¶', const Duration(seconds: 30));
      },
    );
  }

  Future<void> _doInitialize() async {
    // å®é™…åˆå§‹åŒ–é€»è¾‘
  }

  void _handleError(String operation, dynamic error, StackTrace stackTrace) {
    // è®°å½•é”™è¯¯
    print('æ’ä»¶é”™è¯¯ [$operation]: $error');
    print('å †æ ˆè·Ÿè¸ª: $stackTrace');

    // å‘é€é”™è¯¯äº‹ä»¶
    _sendErrorEvent(operation, error);

    // å¯é€‰ï¼šå‘é€é”™è¯¯æŠ¥å‘Šåˆ°æœåŠ¡å™¨
    _reportError(operation, error, stackTrace);
  }

  void _sendErrorEvent(String operation, dynamic error) {
    // å‘é€é”™è¯¯äº‹ä»¶ç»™æ’ä»¶æ³¨å†Œè¡¨
  }

  void _reportError(String operation, dynamic error, StackTrace stackTrace) {
    // å‘é€é”™è¯¯æŠ¥å‘Šåˆ°è¿œç¨‹æœåŠ¡å™¨
  }
}
```

### 3. èµ„æºç®¡ç†

```dart
class ResourceManagedPlugin extends Plugin {
  final List<StreamSubscription> _subscriptions = [];
  final List<Timer> _timers = [];
  final List<Completer> _completers = [];

  @override
  Future<void> dispose() async {
    // æ¸…ç†æ‰€æœ‰è®¢é˜…
    for (final subscription in _subscriptions) {
      await subscription.cancel();
    }
    _subscriptions.clear();

    // æ¸…ç†æ‰€æœ‰å®šæ—¶å™¨
    for (final timer in _timers) {
      timer.cancel();
    }
    _timers.clear();

    // å®Œæˆæ‰€æœ‰æœªå®Œæˆçš„ Completer
    for (final completer in _completers) {
      if (!completer.isCompleted) {
        completer.complete();
      }
    }
    _completers.clear();

    await super.dispose();
  }

  void addSubscription(StreamSubscription subscription) {
    _subscriptions.add(subscription);
  }

  void addTimer(Timer timer) {
    _timers.add(timer);
  }

  void addCompleter(Completer completer) {
    _completers.add(completer);
  }
}
```

## å‘å¸ƒå’Œåˆ†å‘

### 1. æ’ä»¶æ‰“åŒ…

```yaml
# pubspec.yaml
name: my_awesome_plugin
description: æˆ‘çš„è¶…æ£’æ’ä»¶
version: 1.0.0
homepage: https://example.com/my_awesome_plugin
repository: https://github.com/user/my_awesome_plugin

environment:
  sdk: '>=3.2.0 <4.0.0'
  flutter: ">=3.16.0"

dependencies:
  flutter:
    sdk: flutter
  creative_workshop:
    path: ../creative_workshop

dev_dependencies:
  flutter_test:
    sdk: flutter
  very_good_analysis: ^6.0.0

flutter:
  plugin:
    platforms:
      android:
        package: com.example.my_awesome_plugin
        pluginClass: MyAwesomePlugin
      ios:
        pluginClass: MyAwesomePlugin
```

### 2. æ’ä»¶æ¸…å•

```yaml
# plugin_manifest.yaml
plugin:
  id: my_awesome_plugin
  name: æˆ‘çš„è¶…æ£’æ’ä»¶
  version: 1.0.0
  description: è¿™æ˜¯ä¸€ä¸ªè¶…æ£’çš„ç¤ºä¾‹æ’ä»¶
  author: ä½ çš„åå­—
  category: tool
  keywords:
    - å·¥å…·
    - ç¤ºä¾‹
    - è¶…æ£’
  permissions:
    - file_system
  dependencies:
    - plugin_id: base_plugin
      version: ">=1.0.0 <2.0.0"
      required: true
  screenshots:
    - assets/screenshot1.png
    - assets/screenshot2.png
  changelog: CHANGELOG.md
  readme: README.md
```

### 3. å‘å¸ƒæµç¨‹

```bash
# 1. éªŒè¯æ’ä»¶
ming plugin validate

# 2. è¿è¡Œæµ‹è¯•
flutter test

# 3. æ„å»ºæ’ä»¶
ming plugin build

# 4. å‘å¸ƒåˆ°æ’ä»¶å•†åº—
ming plugin publish

# 5. æˆ–è€…å‘å¸ƒåˆ° pub.dev
flutter pub publish
```

## è°ƒè¯•å’Œæ•…éšœæ’é™¤

### 1. è°ƒè¯•æŠ€å·§

```dart
class DebuggablePlugin extends Plugin {
  static const bool _debugMode = kDebugMode;

  void debugLog(String message) {
    if (_debugMode) {
      print('[${DateTime.now()}] [$id] $message');
    }
  }

  @override
  Future<void> initialize() async {
    debugLog('å¼€å§‹åˆå§‹åŒ–æ’ä»¶');

    try {
      await super.initialize();
      debugLog('æ’ä»¶åˆå§‹åŒ–æˆåŠŸ');
    } catch (e, stackTrace) {
      debugLog('æ’ä»¶åˆå§‹åŒ–å¤±è´¥: $e');
      debugLog('å †æ ˆè·Ÿè¸ª: $stackTrace');
      rethrow;
    }
  }

  void debugState() {
    debugLog('æ’ä»¶çŠ¶æ€:');
    debugLog('  - ID: $id');
    debugLog('  - åç§°: $name');
    debugLog('  - ç‰ˆæœ¬: $version');
    debugLog('  - å·²åˆå§‹åŒ–: $isInitialized');
    debugLog('  - æ­£åœ¨è¿è¡Œ: $isRunning');
  }
}
```

### 2. å¸¸è§é—®é¢˜

**Q: æ’ä»¶æ— æ³•å¯åŠ¨**
```dart
// æ£€æŸ¥ä¾èµ–
Future<void> diagnoseStartupIssue() async {
  // 1. æ£€æŸ¥æ’ä»¶æ˜¯å¦å·²æ³¨å†Œ
  if (!PluginRegistry.instance.isPluginRegistered(id)) {
    print('é”™è¯¯: æ’ä»¶æœªæ³¨å†Œ');
    return;
  }

  // 2. æ£€æŸ¥ä¾èµ–æ˜¯å¦æ»¡è¶³
  final dependencies = metadata.dependencies;
  for (final dep in dependencies) {
    if (dep.isRequired && !PluginManager.instance.isPluginInstalled(dep.pluginId)) {
      print('é”™è¯¯: ç¼ºå°‘å¿…éœ€ä¾èµ– ${dep.pluginId}');
      return;
    }
  }

  // 3. æ£€æŸ¥æƒé™
  for (final permission in metadata.permissions) {
    if (!await _hasPermission(permission)) {
      print('é”™è¯¯: ç¼ºå°‘æƒé™ ${permission.displayName}');
      return;
    }
  }

  print('è¯Šæ–­å®Œæˆ: æœªå‘ç°æ˜æ˜¾é—®é¢˜');
}
```

**Q: å†…å­˜æ³„æ¼**
```dart
class MemoryLeakDetector {
  static final Map<String, int> _objectCounts = {};

  static void trackObject(String type) {
    _objectCounts[type] = (_objectCounts[type] ?? 0) + 1;
  }

  static void untrackObject(String type) {
    _objectCounts[type] = (_objectCounts[type] ?? 1) - 1;
    if (_objectCounts[type]! <= 0) {
      _objectCounts.remove(type);
    }
  }

  static void printReport() {
    print('å†…å­˜ä½¿ç”¨æŠ¥å‘Š:');
    _objectCounts.forEach((type, count) {
      print('  $type: $count ä¸ªå¯¹è±¡');
    });
  }
}

class TrackedPlugin extends Plugin {
  TrackedPlugin() {
    MemoryLeakDetector.trackObject('TrackedPlugin');
  }

  @override
  Future<void> dispose() async {
    MemoryLeakDetector.untrackObject('TrackedPlugin');
    await super.dispose();
  }
}
```

## ç¤ºä¾‹æ’ä»¶

### 1. æ–‡ä»¶ç®¡ç†æ’ä»¶

```dart
class FileManagerPlugin extends Plugin {
  @override
  PluginMetadata get metadata => const PluginMetadata(
    id: 'file_manager',
    name: 'æ–‡ä»¶ç®¡ç†å™¨',
    version: '1.0.0',
    description: 'ç®€å•çš„æ–‡ä»¶ç®¡ç†æ’ä»¶',
    author: 'å¼€å‘è€…',
    category: 'utility',
    permissions: [
      PluginPermission.fileSystem,
    ],
  );

  Future<List<FileSystemEntity>> listFiles(String path) async {
    final directory = Directory(path);
    if (!await directory.exists()) {
      throw FileSystemException('ç›®å½•ä¸å­˜åœ¨', path);
    }

    return directory.listSync();
  }

  Future<String> readFile(String path) async {
    final file = File(path);
    if (!await file.exists()) {
      throw FileSystemException('æ–‡ä»¶ä¸å­˜åœ¨', path);
    }

    return file.readAsString();
  }

  Future<void> writeFile(String path, String content) async {
    final file = File(path);
    await file.writeAsString(content);
  }

  Future<void> deleteFile(String path) async {
    final file = File(path);
    if (await file.exists()) {
      await file.delete();
    }
  }
}
```

### 2. é€šçŸ¥æ’ä»¶

```dart
class NotificationPlugin extends Plugin {
  @override
  PluginMetadata get metadata => const PluginMetadata(
    id: 'notification_plugin',
    name: 'é€šçŸ¥æ’ä»¶',
    version: '1.0.0',
    description: 'ç³»ç»Ÿé€šçŸ¥æ’ä»¶',
    author: 'å¼€å‘è€…',
    category: 'utility',
    permissions: [
      PluginPermission.notifications,
    ],
  );

  Future<void> showNotification({
    required String title,
    required String body,
    String? icon,
  }) async {
    // æ£€æŸ¥æƒé™
    if (!await _hasNotificationPermission()) {
      throw PermissionDeniedException('é€šçŸ¥æƒé™è¢«æ‹’ç»');
    }

    // æ˜¾ç¤ºé€šçŸ¥
    await _displayNotification(title, body, icon);
  }

  Future<bool> _hasNotificationPermission() async {
    // æƒé™æ£€æŸ¥é€»è¾‘
    return true; // ç®€åŒ–ç¤ºä¾‹
  }

  Future<void> _displayNotification(String title, String body, String? icon) async {
    // å¹³å°ç‰¹å®šçš„é€šçŸ¥æ˜¾ç¤ºé€»è¾‘
    print('é€šçŸ¥: $title - $body');
  }
}
```

## æ€»ç»“

Creative Workshop çš„æ’ä»¶ç³»ç»Ÿæä¾›äº†å¼ºå¤§è€Œçµæ´»çš„æ‰©å±•æœºåˆ¶ã€‚é€šè¿‡éµå¾ªæœ¬æŒ‡å—ä¸­çš„æœ€ä½³å®è·µï¼Œæ‚¨å¯ä»¥åˆ›å»ºé«˜è´¨é‡ã€é«˜æ€§èƒ½çš„æ’ä»¶ï¼Œä¸ºç”¨æˆ·æä¾›ä¸°å¯Œçš„åŠŸèƒ½ä½“éªŒã€‚

### å…³é”®è¦ç‚¹

1. **éµå¾ªç”Ÿå‘½å‘¨æœŸ**: æ­£ç¡®å®ç°æ’ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
2. **æƒé™ç®¡ç†**: åˆç†å£°æ˜å’Œä½¿ç”¨æƒé™
3. **ä¾èµ–ç®¡ç†**: æ­£ç¡®å¤„ç†æ’ä»¶ä¾èµ–å…³ç³»
4. **é”™è¯¯å¤„ç†**: å®ç°å¥å£®çš„é”™è¯¯å¤„ç†æœºåˆ¶
5. **èµ„æºç®¡ç†**: åŠæ—¶æ¸…ç†èµ„æºé¿å…å†…å­˜æ³„æ¼
6. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨æ‡’åŠ è½½ã€ç¼“å­˜ç­‰ä¼˜åŒ–æŠ€æœ¯
7. **æµ‹è¯•è¦†ç›–**: ç¼–å†™å…¨é¢çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### ä¸‹ä¸€æ­¥

- æŸ¥çœ‹ [API æ–‡æ¡£](../api/api.md) äº†è§£è¯¦ç»†çš„ API æ¥å£
- å‚è€ƒ [æ¶æ„æ–‡æ¡£](../architecture/architecture.md) ç†è§£ç³»ç»Ÿè®¾è®¡
- é˜…è¯» [ç”¨æˆ·æŒ‡å—](../guides/user_guide.md) äº†è§£ç”¨æˆ·ä½“éªŒ
- æŸ¥çœ‹ç¤ºä¾‹æ’ä»¶ä»£ç è·å–æ›´å¤šçµæ„Ÿ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 5.0.6
**æœ€åæ›´æ–°**: 2025-07-22
**é€‚ç”¨ç‰ˆæœ¬**: Creative Workshop 5.0.6+
**ç»´æŠ¤è€…**: Creative Workshop æ’ä»¶å¼€å‘å›¢é˜Ÿ
